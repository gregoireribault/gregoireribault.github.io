/*! For license information please see game.js.LICENSE.txt */
(()=>{var t,e,i,n,s={691:(t,e,i)=>{"use strict";i.d(e,{$e:()=>a,Ao:()=>et,D7:()=>$,DK:()=>y,Fw:()=>R,IL:()=>B,KP:()=>h,Kq:()=>r,Ks:()=>V,Mb:()=>_,N0:()=>u,NB:()=>L,NL:()=>q,Ov:()=>P,Pj:()=>Z,SL:()=>it,Sk:()=>v,TK:()=>w,UO:()=>j,US:()=>Y,V1:()=>A,VM:()=>l,WO:()=>U,Wi:()=>nt,X3:()=>N,YZ:()=>D,Zc:()=>c,bs:()=>G,cl:()=>M,eM:()=>st,e_:()=>s,ej:()=>z,hF:()=>X,hR:()=>k,jH:()=>m,kE:()=>T,kw:()=>C,lC:()=>o,nN:()=>O,nX:()=>S,o5:()=>K,pR:()=>J,qx:()=>x,rH:()=>b,s5:()=>Q,sA:()=>n,sC:()=>f,sO:()=>p,tG:()=>F,tJ:()=>g,tz:()=>E,ue:()=>tt,vg:()=>I,wY:()=>d,xo:()=>W,zU:()=>H});const n="data/sprites.loz",s="data/sounds.loz",r="audio/sounds.mp3",o="images/sprites.png",a="data/game.loz",h=32,l=32,c=16,u=11,p=16,d=8,g="json",f="loz",m="mp3",v="png",y="webp",_=50,w=50,x=30,A=96,b="world",I="caverns",T="level1",k=32,M=32,S="get_rupee",N="overworld",E="stairs",O="text_loop",C="link",L="text",P="red",K="white",F=16,B=16,V="normal",R="green",D="move",U="pick",Y="user_item_a",H="user_item_b",$="east",X="north",W="south",G="west",Z="cave_entrance",q="cave_exit",z="cave_stairs_down",J="cave_stairs_up",j="map_drag",Q=8,tt=10,et="east",it="north",nt="south",st="west"},385:(t,e,i)=>{"use strict";i.d(e,{y:()=>r});var n=i(691),s=i(113);i(151);class r{game;displayBlockingZones;blockingZonesColor;constructor(t,e,i,r,o,a,h,l,c){const u=this;t.addEventListener("change",(t=>{t.preventDefault(),u.displayBlockingZones=t.target.checked})),t.checked=!1,t.dispatchEvent(new Event("change")),e.addEventListener("change",(t=>{t.preventDefault(),u.blockingZonesColor=t.target.value})),e.value="#ff0000",e.dispatchEvent(new Event("change")),r.addEventListener("click",(t=>{t.preventDefault(),u.game.link.inventory.rupees=Math.min(Math.max(i.value,0),u.game.link.inventory.maxRupees),i.value=void 0})),a.addEventListener("click",(t=>{t.preventDefault(),u.game.link.inventory.keys=Math.min(Math.max(o.value,0),u.game.link.inventory.maxKeys),o.value=void 0})),l.addEventListener("click",(t=>{t.preventDefault(),u.game.link.inventory.bombs=Math.min(Math.max(h.value,0),u.game.link.inventory.maxBombs),h.value=void 0})),c.addEventListener("click",(async t=>{t.preventDefault();let e=await s.A.openFile();e=JSON.stringify(e),await s.A.dowloadFile(e,n.sC)}))}setGame(t){this.game=t}draw(t){this.displayBlockingZones&&this.drawBlockingZones(t,this.blockingZonesColor)}drawBlockingZones(t,e){const i=this.game.map;t.translate(0,n.V1),t.translate(-i.x,-i.y),i.drawBlockingZones(t,e),this.game.nextMap&&this.game.nextMap.drawBlockingZones(t,e),t.translate(i.x,i.y),t.translate(0,-n.V1)}}},418:(t,e,i)=>{"use strict";i.d(e,{A:()=>T});var n=i(626),s=i(987),r=i(691);class o{async play(t){return new Promise((e=>{t.y+=r.VM;const i=t.y-3*r.VM,n=setInterval((()=>{t.startWalking(),t.y-=2,t.y<=i&&(clearInterval(n),t.stopWalking(),e())}),15)}))}static get name(){return r.Pj}}class a{async play(t,e){return new Promise((i=>{const n=setInterval((()=>{t.startWalking(),t.y+=2,t.y>e.y+e.height&&(clearInterval(n),t.stopWalking(),i())}),15)}))}static get name(){return r.NL}}class h{async play(t){return new Promise((e=>{n.A.stop(s.A.getSound(r.X3)),n.A.play(s.A.getSound(r.tz)),t.direction=r.SL,t.x=t.tile.x,t.y=t.tile.y,t.clipY=0,t.startWalking();const i=setInterval((()=>{t.clipY++,t.clipY>=r.VM&&(clearInterval(i),t.clipY=0,t.stopWalking(),e())}),30)}))}static get name(){return r.ej}}class l{async play(t){return new Promise((e=>{n.A.play(s.A.getSound(r.tz)),t.direction=r.Wi,t.clipY=r.VM,t.startWalking();const i=setInterval((()=>{t.clipY--,t.clipY<=0&&(clearInterval(i),t.clipY=0,t.stopWalking(),n.A.play(s.A.getSound(r.X3)),e())}),30)}))}static get name(){return r.pR}}class c{async play(t,e,i){return t.direction===r.Ao?this.playEast(t,e,i):t.direction===r.SL?this.playNorth(t,e,i):t.direction===r.Wi?this.playSouth(t,e,i):t.direction===r.eM?this.playWest(t,e,i):void 0}playEast(t,e,i){e.offsetX=0,i.offsetX=0,t.x=e.x+e.width-t.width;const n=Math.round(i.width/r.s5),s=(i.width-t.width)/n;return new Promise((n=>{const o=setInterval((()=>{t.startWalking(),e.offsetX-=r.s5,i.offsetX-=r.s5,t.x-=s,e.offsetX<-e.width&&i.offsetX<-i.width&&(clearInterval(o),i.offsetX=0,t.stopWalking(),t.x=i.x,e.offsetX=0,n())}),r.ue)}))}playNorth(t,e,i){e.offsetY=0,i.offsetY=0,t.y=e.y;const n=Math.round(i.height/r.s5),s=(i.height-t.height)/n;return new Promise((n=>{const o=setInterval((()=>{t.startWalking(),e.offsetY+=r.s5,i.offsetY+=r.s5,t.y+=s,e.offsetY>e.height&&i.offsetY>i.height&&(clearInterval(o),i.offsetY=0,t.stopWalking(),t.y=i.y+i.height-t.height,e.offsetY=0,n())}),r.ue)}))}playSouth(t,e,i){e.offsetY=0,i.offsetY=0,t.y=e.y+e.height-t.height;const n=Math.round(i.height/r.s5),s=(i.height-t.height)/n;return new Promise((n=>{const o=setInterval((()=>{t.startWalking(),e.offsetY-=r.s5,i.offsetY-=r.s5,t.y-=s,e.offsetY<-e.height&&i.offsetY<-i.height&&(clearInterval(o),i.offsetY=0,t.stopWalking(),t.y=i.y,e.offsetY=0,n())}),r.ue)}))}playWest(t,e,i){e.offsetX=0,i.offsetX=0,t.x=e.x;const n=Math.round(i.width/r.s5),s=(i.width-t.width)/n;return new Promise((n=>{const o=setInterval((()=>{t.startWalking(),e.offsetX+=r.s5,i.offsetX+=r.s5,t.x+=s,e.offsetX>e.width&&i.offsetX>i.width&&(clearInterval(o),i.offsetX=0,t.stopWalking(),t.x=i.x+i.width-t.width,e.offsetX=0,n())}),r.ue)}))}static get name(){return r.UO}}class u{async play(t){let e=0;return n.A.play(s.A.getSound(r.nN)),new Promise((i=>{const o=setInterval((()=>{e++,t.map.character.displayedText=t.map.character.text.substring(0,e),t.map.character.displayedText===t.map.character.text&&(n.A.stop(s.A.getSound(r.nN)),clearInterval(o),i())}),50)}))}static get NAME(){return DIALOG_NAME}}const p={transitions:{[o.name]:new o,[a.name]:new a,[h.name]:new h,[l.name]:new l,[c.name]:new c},get:function(t){return this.transitions[t]}};var d=i(66),g=i(73);const f=16,m=16;class v{constructor(t){this.link=t,this.map=void 0,this.mapLocationWidth=void 0,this.mapLocationHeight=void 0}initializeMap(t){this.map=t}draw(t){t.fillStyle="black",t.fillRect(0,0,512,96),t.translate(16,16),t.fillStyle="grey",t.fillRect(0,0,128,64);const e=128/r.sO,i=64/r.wY;t.fillStyle="green",t.fillRect(this.link.map.column*e,this.link.map.line*i,e,i),t.translate(-16,-16),s.A.getSprite("menu_rupee").draw(t,160,16,f,m),d.A.draw(t,"x"+this.link.inventory.rupees,r.o5,176,16,4*r.tG,r.IL,"left"),s.A.getSprite("menu_key").draw(t,160,48,f,m),d.A.draw(t,"x"+this.link.inventory.keys,r.o5,176,48,4*r.tG,r.IL,"left"),s.A.getSprite("menu_bomb").draw(t,160,64,f,m),d.A.draw(t,"x"+this.link.inventory.bombs,r.o5,176,64,4*r.tG,r.IL,"left"),s.A.getSprite("menu_blue_line_corner_north_west").draw(t,256,16,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,256,32,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,256,48,f,m),s.A.getSprite("menu_blue_line_corner_south_west").draw(t,256,64,f,m),s.A.getSprite("menu_blue_line_horizontal").draw(t,272,64,f,m),s.A.getSprite("menu_blue_line_corner_south_east").draw(t,288,64,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,288,48,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,288,32,f,m),s.A.getSprite("menu_blue_line_corner_north_east").draw(t,288,16,f,m),d.A.draw(t,"b",r.o5,272,16,16,16),void 0!==this.link.itemB&&this.link.itemB.draw(t,264,32),s.A.getSprite("menu_blue_line_corner_north_west").draw(t,304,16,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,304,32,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,304,48,f,m),s.A.getSprite("menu_blue_line_corner_south_west").draw(t,304,64,f,m),s.A.getSprite("menu_blue_line_horizontal").draw(t,320,64,f,m),s.A.getSprite("menu_blue_line_corner_south_east").draw(t,336,64,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,336,48,f,m),s.A.getSprite("menu_blue_line_vertical").draw(t,336,32,f,m),s.A.getSprite("menu_blue_line_corner_north_east").draw(t,336,16,f,m),d.A.draw(t,"a",r.o5,320,16,16,16),void 0!==this.link.itemA&&this.link.itemA.draw(t,312,32),d.A.draw(t,"-life-",r.Ov,384,16,96,16);let n=368,o=64;for(let e=0;e<this.link.totalLife;e++)e<Math.floor(this.link.currentLife+.25)?s.A.getSprite("menu_heart_full").draw(t,n,o,f,m):e<this.currentLife?s.A.getSprite("menu_heart_half").draw(t,n,o,f,m):s.A.getSprite("menu_heart_empty").draw(t,n,o,f,m),n+=f,7===e&&(o-=m,n=368)}}var y=i(783);class _{constructor(){this.shield=r.Ks,this.ring=r.Fw,this.arrow=void 0,this.bookOfMagic=void 0,this.ladder=void 0,this.magicalKey=void 0,this.powerBracelet=void 0,this.rupees=0,this.keys=0,this.bombs=0,this.maxRupees=255,this.maxKeys=8,this.maxBombs=8}}class w extends EventTarget{constructor(t,e,i,n){super(),this.x=t,this.y=e,this.width=32,this.height=32,this.speed=10,this.action=r.YZ,this.direction=r.xo,this.clipX=0,this.clipY=0,this.inventory=new _,this.totalLife=3,this.currentLife=3,this.items=[],this._itemA=void 0,this._itemB=void 0,this.actions=[]}canAfford(t){return void 0===t.price||this.rupees>=t.price}buy(t){if(void 0!==t.price){let i=t.price;const o=this,a=setInterval((()=>{n.A.play(s.A.getSound(r.nX))}),200);var e=setInterval((()=>{i--,o.rupees--,0===i&&(clearInterval(e),clearInterval(a),o.rupees<0&&(o.rupee=0))}),25)}}useItemA(){void 0!==this.itemA&&this.itemA.use()}useItemB(){void 0!==this.itemB&&this.itemB.use()}getHitbox(t,e){return{x:(t=t||this.x)+2,y:(e=e||this.y)+this.height/2+2,width:this.width-4,height:this.height/2-4}}move(t,e){let i,n,s=this.x,o=this.y;switch(e){case r.D7:this.direction=r.D7,s+=this.speed,i=y.A.compute(this.getHitbox(s,o)),n=y.A.computeHitboxesCollision(t.hitbox,i),n&&(s=y.A.getMinX(n)-this.width),this.x=s;break;case r.hF:this.direction=r.hF,o-=this.speed,i=y.A.compute(this.getHitbox(s,o)),n=y.A.computeHitboxesCollision(t.hitbox,i),n&&(o=y.A.getMaxY(n)-this.height/2),this.y=o;break;case r.xo:this.direction=r.xo,o+=this.speed,i=y.A.compute(this.getHitbox(s,o)),n=y.A.computeHitboxesCollision(t.hitbox,i),n&&(o=y.A.getMinY(n)-this.height),this.y=o;break;case r.bs:this.direction=r.bs,s-=this.speed,i=y.A.compute(this.getHitbox(s,o)),n=y.A.computeHitboxesCollision(t.hitbox,i),n&&(s=y.A.getMaxX(n)),this.x=s}this.hitbox=y.A.compute(this)}startWalking(){const t=s.A.getSprite(`${r.kw}_${this.inventory.ring}_${this.direction}_${this.inventory.shield}_${this.action}`);t?t.start():console.log(`${r.kw}_${this.inventory.ring}_${this.direction}_${this.inventory.shield}_${this.action}`)}stopWalking(){const t=s.A.getSprite(`${r.kw}_${this.inventory.ring}_${this.direction}_${this.inventory.shield}_${this.action}`);t?t.stop():console.log(`${r.kw}_${this.inventory.ring}_${this.direction}_${this.inventory.shield}_${this.action}`)}drawSword(t,e,i){t.save();const n=this.itemA.sprite.width,s=this.itemA.sprite.height,r=e+this.x+this.clipX,o=i+this.y+this.clipY,a=this.width-this.clipX,h=this.height-this.clipY;t.setTransform(1,0,0,1,r+a/2,o+h/2);let l=0;const c=-3/4*h;this.direction===DIRECTION_EAST&&(t.rotate(90*Math.PI/180),l=1/8*a),this.direction===DIRECTION_SOUTH&&t.rotate(180*Math.PI/180),this.direction===DIRECTION_WEST&&(t.rotate(-90*Math.PI/180),l=-1/8*a),this.direction,DIRECTION_NORTH,this.itemA.sprite.draw(t,0,0,n,s,-a/2+l,-h/2+c,n,s),t.restore()}draw(t,e,i,n){n===r.US&&this.drawSword(t,e,i);const o=this.getSpriteName(n);s.A.getSprite(o)?s.A.getSprite(o).draw(t,0,0,this.width-this.clipX,this.height-this.clipY,e+this.x+this.clipX,i+this.y+this.clipY,this.width-this.clipX,this.height-this.clipY):console.log(o)}getSpriteName(t){switch(t){case r.WO:return`${r.kw}_${this.inventory.ring}_${r.WO}`;case r.US:case r.zU:return`${r.kw}_${this.inventory.ring}_${this.shield}_${r.WO}`;case r.YZ:return`${r.kw}_${this.inventory.ring}_${this.direction}_${this.inventory.shield}_${r.YZ}`}}addItem(t){this.items.push(t)}removeItem(t){for(let e=0;e<this.items.length;e++)this.items[e].constructor.name===t.name&&this.items.splice(e,1)}hasItem(t){for(let e=0;e<this.items.length;e++)if(this.items[e].constructor.name===t.name)return!0;return!1}addAction(t){-1===this.actions.indexOf(t)&&this.actions.push(t)}hasAction(t){return this.actions.indexOf(t)>-1}removeAction(t){const e=this.actions.indexOf(t);e>-1&&this.actions.splice(e,1)}resetActions(){this.actions=[]}get itemA(){return this._itemA}set itemA(t){this._itemA=t,this.dispatchEvent(new Event("item_a_changed"))}get itemB(){return this._itemB}set itemB(t){this._itemB=t,this.dispatchEvent(new Event("item_b_changed"))}}const x=w;class A{constructor(t,e,i,n){this.key=t,this.action=e,this.blockingAction=i,this.enabled=n,this.pressed=!1,this.used=!1}use(){return this.used=!0,this.action}disable(){this.enabled=!1}enable(){this.enabled=!0}unuse(){return this.used=!1,this.action}press(){this.pressed=!0}unpress(){this.pressed=!1}static get BLOCKING_ACTION(){return!0}static get ENABLED(){return!0}}const b={ACTION_LINK_MOVE_WEST:"link_move_west",ACTION_LINK_MOVE_NORTH:"link_move_north",ACTION_LINK_MOVE_EAST:"link_move_east",ACTION_LINK_MOVE_SOUTH:"link_move_south",ACTION_LINK_USE_ITEM_A:"link_use_item_a",ACTION_LINK_USE_ITEM_B:"link_use_item_b",ACTION_MENU_CLOSE:"menu_close",ACTION_MENU_MOVE_LEFT:"menu_move_left",ACTION_MENU_MOVE_TOP:"menu_move_top",ACTION_MENU_MOVE_RIGHT:"menu_move_right",ACTION_MENU_MOVE_BOTTOM:"menu_move_bottom",ACTION_MENU_OPEN:"menu_open",MAPPING_MAIN:"mapping_main",MAPPING_MENU:"mapping_menu",mappings:{},currentMappingName:void 0,actionKeys:[],setMapping:function(){this.mappings=[],this.mappings[37]=new A(37,this.ACTION_LINK_MOVE_WEST,!A.BLOCKING_ACTION,A.ENABLED),this.mappings[38]=new A(38,this.ACTION_LINK_MOVE_NORTH,!A.BLOCKING_ACTION,A.ENABLED),this.mappings[39]=new A(39,this.ACTION_LINK_MOVE_EAST,!A.BLOCKING_ACTION,A.ENABLED),this.mappings[40]=new A(40,this.ACTION_LINK_MOVE_SOUTH,!A.BLOCKING_ACTION,A.ENABLED),this.mappings[65]=new A(65,this.ACTION_LINK_USE_ITEM_A,A.BLOCKING_ACTION,!A.ENABLED),this.mappings[66]=new A(66,this.ACTION_LINK_USE_ITEM_B,A.BLOCKING_ACTION,!A.ENABLED)},getCurrentDrawingAction:function(){for(let t=0;t<this.actionKeys.length;t++)if(this.actionKeys[t].blockingAction)return this.actionKeys[t].use();return this.actionKeys[0]?.use()},getCurrentAction:function(){for(let t=0;t<this.actionKeys.length;t++)if(this.actionKeys[t].blockingAction&&!this.actionKeys[t].used)return this.actionKeys[t].use();return this.actionKeys[0]&&!this.actionKeys[0].blockingAction?this.actionKeys[0].use():void 0},clear:function(){this.actionKeys=[]},getKey:function(t){return this.mappings[t]},addActionKey:function(t){this.actionKeys.unshift(t)},removeActionKey:function(t){const e=this.actionKeys.indexOf(t);-1!==e&&this.actionKeys.splice(e,1)},triggerBlockingAction(t){if(t.blockingAction){t.disable();const e=this;setTimeout((()=>{e.removeActionKey(t),t.enable()}),5*r.TK)}},handleKeyDown:function(t){const e=this.getKey(t);e&&e.enabled&&e&&!e.pressed&&(this.removeActionKey(e),this.addActionKey(e),this.triggerBlockingAction(e),e.press())},handleKeyUp:function(t){const e=this.getKey(t);e&&(this.removeActionKey(e),e.unuse(),e.unpress())},enable(t){for(const e in this.mappings)this.mappings[e].action===t&&this.mappings[e].enable()},startDetection:function(){const t=this;document.onkeydown=function(e){t.handleKeyDown(e.keyCode)},document.onkeyup=function(e){t.handleKeyUp(e.keyCode)}},stopDetection:function(){document.onkeydown=void 0,document.onkeyup=void 0}};var I=i(981);const T=class{constructor(){const t=g.A.findStartingPosition();if(!t)throw new Error("No starting position found");const e=t.map,i=new x(e.x+t.tileColumn*r.KP,e.y+t.tileLine*r.VM,r.KP,r.VM);i.map=e,this.topMenu=new v(i),this.map=e,this.nextMap=void 0,this.link=i,this.link.addEventListener(x.EVENT_ITEM_A_CHANGED,(()=>b.enable(b.ACTION_LINK_USE_ITEM_A))),this.link.addEventListener(x.EVENT_ITEM_B_CHANGED,(()=>b.enable(b.ACTION_LINK_USE_ITEM_B))),this.isStarted=!1,this.transitionPlaying=!1}start(){this.map.hitbox=y.A.computeMapHitboxV2(this.map),this.map.init(),this.link.hitbox=y.A.compute(this.link),b.setMapping(),b.startDetection(),b.currentMappingName=b.MAPPING_MAIN,this.isStarted=!0,n.A.play(s.A.getSound(r.X3))}draw(t,e,i,n,s){this.isStarted&&(t.clearRect(e,i,n,s),t.translate(0,r.V1),t.translate(-this.map.x,-this.map.y),this.map.draw(t),this.mapDragTransitionPlaying&&this.nextMap.draw(t),this.link.draw(t,0,0,this.getLinkActionFromInput(b.getCurrentDrawingAction())),t.translate(this.map.x,this.map.y),t.translate(0,-r.V1),this.topMenu.draw(t))}async process(){if(!this.isStarted)return;if(this.transitionPlaying)return;if(this.map.character&&!this.map.character.hasStoppedTalking()){this.transitionPlaying=!0,this.link.resetActions();const t=new u;return await t.play(this.link),void(this.transitionPlaying=!1)}const t=y.A.getLinkTile(this.map,this.link);t&&t!==this.link.tile&&(t.tileTransition.enabled=!0),this.link.tile=t;const e=y.A.getLinkFrontTile(this.map,this.link);let i;if(this.link.tile&&!e&&(i=this.createDynamicMapDragTileTransition(),this.mapDragTransitionPlaying=!0),this.link.tile&&e&&(i=this.link.tile.tileTransition),i&&i.enabled&&i.start){this.transitionPlaying=!0,this.link.resetActions(),this.nextMap=i.getTargetMap(),this.nextMap.init();const t=p.get(i.start);t&&await t.play(this.link,this.map,this.nextMap),this.map.reset(),this.map=i.getTargetMap(),this.nextMap=void 0,this.map.hitbox=y.A.computeMapHitboxV2(this.map),this.link.x=i.getTargetPosition().x,this.link.y=i.getTargetPosition().y;const e=p.get(i.end);return e&&await e.play(this.link),this.link.tile=y.A.getLinkTile(this.map,this.link),this.link.tile.tileTransition.enabled=!1,this.link.map=this.map,this.transitionPlaying=!1,this.mapDragTransitionPlaying=!1,void(i.enabled=!1)}this.processLinkActions()}createDynamicMapDragTileTransition(){let t,e,i,n;return this.link.direction===r.Ao&&(t=this.map.column+1,e=this.map.line,i=0,n=this.link.y%(r.N0*r.VM)/r.VM),this.link.direction===r.SL&&(t=this.map.column,e=this.map.line-1,i=this.link.x%(r.Zc*r.KP)/r.KP,n=r.N0-1),this.link.direction===r.Wi&&(t=this.map.column,e=this.map.line+1,i=this.link.x%(r.Zc*r.KP)/r.KP,n=0),this.link.direction===r.eM&&(t=this.map.column-1,e=this.map.line,i=r.Zc-1,n=this.link.y%(r.N0*r.VM)/r.VM),new I.A(c.name,this.map.type,t,e,i,n)}processLinkActions(){let t=!1;const e=[b.ACTION_LINK_MOVE_EAST,b.ACTION_LINK_MOVE_NORTH,b.ACTION_LINK_MOVE_SOUTH,b.ACTION_LINK_MOVE_WEST];for(let i=0;i<e.length;i++)this.link.hasAction(e[i])&&(t=!0);if(t?this.link.startWalking():this.link.stopWalking(),0===this.link.actions.length)this.link.action=r.YZ;else for(let t=0;t<this.link.actions.length;t++)this.processAction(this.link.actions[t])}getLinkActionFromInput(t){switch(t){case b.ACTION_LINK_MOVE_EAST:case b.ACTION_LINK_MOVE_NORTH:case b.ACTION_LINK_MOVE_SOUTH:case b.ACTION_LINK_MOVE_WEST:return r.YZ;case b.ACTION_LINK_USE_ITEM_A:return r.US;case b.ACTION_LINK_USE_ITEM_B:return r.zU;default:return r.YZ}}processAction(t){switch(t){case b.ACTION_LINK_MOVE_EAST:this.link.move(this.map,r.D7);break;case b.ACTION_LINK_MOVE_NORTH:this.link.move(this.map,r.hF);break;case b.ACTION_LINK_MOVE_SOUTH:this.link.move(this.map,r.xo);break;case b.ACTION_LINK_MOVE_WEST:this.link.move(this.map,r.bs);break;case b.ACTION_LINK_USE_ITEM_A:this.link.useItemA();break;case b.ACTION_LINK_USE_ITEM_B:this.link.useItemB();case b.ACTION_MENU_CLOSE:case b.ACTION_MENU_MOVE_BOTTOM:case b.ACTION_MENU_MOVE_LEFT:case b.ACTION_MENU_MOVE_RIGHT:case b.ACTION_MENU_MOVE_TOP:case b.ACTION_MENU_OPEN:}this.link.removeAction(t)}processInput(){if(!this.isStarted)return;if(this.transitionPlaying)return;const t=b.getCurrentAction();t&&this.link.addAction(t)}}},526:(t,e,i)=>{"use strict";i.a(t,(async(t,e)=>{try{var n=i(418),s=i(385),r=i(113),o=i(987),a=i(626),h=i(73),l=i(691);let c,u,p,d,g;const f=document.querySelector("#loz-canvas"),m=f.getContext("2d");async function v(t){h.A.createMaps(t),c=new n.A,u.setGame(c),clearInterval(p),p=setInterval((()=>{c.draw(m,0,0,f.width,f.height),u.draw(m,0,0,f.width,f.height)}),l.Mb),clearInterval(d),d=setInterval((()=>c.process()),l.TK),clearInterval(g),g=setInterval((()=>c.processInput()),l.qx),c.start()}f.width=l.Zc*l.KP,f.height=l.N0*l.VM+l.V1,f.onload=()=>{f.focus()},u=new s.y(document.querySelector("input#control-blocking-zones"),document.querySelector("input#control-blocking-zones-color"),document.querySelector("input#control-rupees"),document.querySelector("input#control-rupees-submit"),document.querySelector("input#control-keys"),document.querySelector("input#control-keys-submit"),document.querySelector("input#control-bombs"),document.querySelector("input#control-bombs-submit"),document.querySelector("input#control-convert-file-to-loz")),a.A.initContext(),a.A.initEvents(document.querySelector("input#play-sounds"),document.querySelector("input#control-volume")),await o.A.loadAll();const y=await r.A.fetchRemoteFile(l.$e);await v(y),document.querySelector("input#control-import-game").addEventListener("click",(async t=>{t.preventDefault(),v(await r.A.openFile(l.sC))})),e()}catch(_){e(_)}}),1)},282:(t,e,i)=>{"use strict";i.d(e,{K:()=>r});var n=i(691),s=i(66);class r{constructor(t,e,i,n,s,r,o,a){this.column=t,this.line=e,this.x=i,this.y=n,this.width=s,this.height=r,this.sprite=o,this.text=a,this.displayedText=""}init(){this.sprite.start()}reset(){this.sprite.stop(),this.displayedText=""}hasStoppedTalking(){return this.displayedText===this.text}draw(t){this.sprite.draw(t,this.x,this.y,this.width,this.height),s.A.draw(t,this.text,n.o5,this.x-4.5*n.KP-n.KP/2,this.y-3*n.IL,11*n.KP,3*n.IL,"middle",this.displayedText.length)}}},19:(t,e,i)=>{"use strict";i.d(e,{$:()=>n});class n{constructor(t,e,i,n,s,r,o){this.column=t,this.line=e,this.x=i,this.y=n,this.width=s,this.height=r,this.sprite=o}init(){this.sprite.start()}reset(){this.sprite.stop()}draw(t){this.sprite.draw(t,this.x,this.y,this.width,this.height)}}},790:(t,e,i)=>{"use strict";i.d(e,{q:()=>r});var n=i(691),s=i(66);class r{constructor(t,e,i,n,s,r,o,a){this.column=t,this.line=e,this.x=i,this.y=n,this.width=s,this.height=r,this.sprite=o,this.price=a}init(){this.sprite.start()}reset(){this.sprite.stop()}draw(t){this.sprite.draw(t,this.x,this.y,this.width,this.height),this.price&&s.A.draw(t,this.price.toString(),n.o5,this.x-.5*n.KP,this.y+1.5*n.VM,1.5*n.KP,n.VM,"right")}}},999:(t,e,i)=>{"use strict";i.d(e,{T:()=>n});class n{constructor(t,e,i,n,s,r,o,a,h,l,c){this.column=t,this.line=e,this.x=i,this.y=n,this.offsetX=0,this.offsetY=0,this.width=s,this.height=r,this.type=o,this.tiles=a,this.characters=h,this.items=l,this.extras=c,this.savedItems=[],this.savedCharacters=[],this.mapPath=this.getMapPath()}get character(){return this.characters[0]}getMapPath(){const t=new Path2D;return t.rect(this.x,this.y,this.width,this.height),t}init(){for(const t of this.characters)t.init();for(const t of this.items)t.init();for(const t of this.extras)t.init()}reset(){for(const t of this.characters)t.reset();for(const t of this.items)t.reset();for(const t of this.extras)t.reset()}draw(t){t.save(),t.translate(this.offsetX,this.offsetY),this.x,this.y;for(const e of this.tilesIterator())e.draw(t);for(const e of this.characters)e.draw(t);for(const e of this.items)e.draw(t);for(const e of this.extras)e.draw(t);t.translate(-this.offsetX,-this.offsetY),t.restore()}drawBlockingZones(t,e){t.save(),t.translate(this.offsetX,this.offsetY),t.globalAlpha=.5,t.fillStyle=e;for(const e of this.tilesIterator())t.fill(e.blockPath);t.translate(-this.offsetX,-this.offsetY),t.restore()}*tilesIterator(){for(let t=0;t<this.tiles.length;t++)for(let e=0;e<this.tiles[t].length;e++)yield this.tiles[t][e]}getTile(t,e){return this.tiles[t]?this.tiles[t][e]:void 0}}},701:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});class n{constructor(t,e,i,n,s,r,o,a){this.name=t,this.buffer=e,this.context=i,this.gain=n,this.duration=s,this.loop=r,this.loopStart=o,this.loopEnd=a,this.source=void 0}play(){this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain),this.source.loop=this.loop,this.source.loopStart=this.loopStart,this.source.loopEnd=this.loopEnd,this.source.start(0)}stop(){this.source&&this.source.stop(0)}}},365:(t,e,i)=>{"use strict";i.d(e,{J:()=>n,k:()=>s});class n{constructor(t,e,i,n,s){this.name=t,this.file=e,this.offset=i,this.width=n,this.height=s}draw(t,e,i,n,s,r,o,a,h){void 0===r||void 0===o||void 0===a||void 0===h?t.drawImage(this.file,this.offset.x,this.offset.y,this.width,this.height,e,i,n,s):t.drawImage(this.file,this.offset.x+e,this.offset.y+i,n,s,r,o,a,h)}}class s{constructor(t,e,i){this.name=t,this.type=e,this.images=i,this.currentImageIndex=0,this.incrementSpeed=200,this.incrementInterval=void 0}clone(){return new s(this.name,this.type,this.images)}start(){if(this.incrementInterval)return;const t=this;return this.incrementImageIndex(),this.incrementInterval=setInterval((()=>{t.incrementImageIndex()}),this.incrementSpeed),this}stop(){return clearInterval(this.incrementInterval),this.incrementInterval=void 0,this}incrementImageIndex(){this.images&&(this.currentImageIndex++,this.currentImageIndex>=this.images.length&&(this.currentImageIndex=0))}draw(t,e,i,n,s,r,o,a,h){this.images&&this.images[this.currentImageIndex]&&this.images[this.currentImageIndex].draw(t,e,i,n,s,r,o,a,h)}get width(){return this.images[this.currentImageIndex]?.width}get height(){return this.images[this.currentImageIndex]?.height}}},981:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});var n=i(691),s=i(73);class r{constructor(t,e,i,n,s,r,o){this.start=t,this.targetMapType=e,this.targetMapColumn=i,this.targetMapLine=n,this.targetTileColumn=s,this.targetTileLine=r,this.end=o,this.enabled=!0}isEmpty(){return!(this.start||this.targetMapType||this.targetMapColumn||this.targetMapLine||this.targetTileColumn||this.targetTileLine||this.end)}getTargetMap(){return s.A.getMap(this.targetMapType,this.targetMapColumn,this.targetMapLine)}getTargetPosition(){return{x:this.getTargetMap().x+this.targetTileColumn*n.KP,y:this.getTargetMap().y+this.targetTileLine*n.VM}}clone(){return new r(this.start,this.targetMapType,this.targetMapColumn,this.targetMapLine,this.targetTileColumn,this.targetTileLine,this.end)}}},861:(t,e,i)=>{"use strict";i.d(e,{F:()=>n}),i(981);class n{constructor(t,e,i,n,s,r,o,a,h,l,c,u){this.column=t,this.line=e,this.x=i,this.y=n,this.width=s,this.height=r,this.hitbox=o,this.sprite=a,this.transition=void 0,this.tilePath=this.getTilePath(),this.blockPath=this.getBlockPath(),this.block=h,this.desctructible=l,this.tileTransition=c,this.start=u}recomputePaths(){this.tilePath=this.getTilePath(),this.blockPath=this.getBlockPath()}clone(){return new n(this.column,this.line,this.x,this.y,this.width,this.height,this.hitbox,this.sprite.clone(),this.block,this.desctructible,this.tileTransition.clone())}draw(t,e,i){const n=void 0!==e?this.x+e:this.x,s=void 0!==i?this.y+i:this.y;this.sprite.draw(t,n,s,this.width,this.height),this.other&&this.other.draw(t,n,s,this.width,this.height)}getTilePath(){const t=new Path2D;return t.rect(this.x,this.y,this.width,this.height),t}getBlockPath(){if("string"!=typeof this.hitbox)return;const t=[];"1"===this.hitbox.charAt(0)&&t.push([this.x,this.y]),"1"===this.hitbox.charAt(1)&&t.push([this.x+this.width/2,this.y]),"1"===this.hitbox.charAt(2)&&t.push([this.x+this.width,this.y]),"1"===this.hitbox.charAt(3)&&t.push([this.x+this.width,this.y+this.height/2]),"1"===this.hitbox.charAt(4)&&t.push([this.x+this.width,this.y+this.height]),"1"===this.hitbox.charAt(5)&&t.push([this.x+this.width/2,this.y+this.height]),"1"===this.hitbox.charAt(6)&&t.push([this.x,this.y+this.height]),"1"===this.hitbox.charAt(7)&&t.push([this.x,this.y+this.height/2]);const e=new Path2D;t[0]&&e.moveTo(t[0][0],t[0][1]);for(let i=1;i<t.length;i++)e.lineTo(t[i][0],t[i][1]);return e}}},987:(t,e,i)=>{"use strict";i.d(e,{A:()=>c});var n=i(113),s=i(626),r=i(691),o=i(365),a=i(701);const h={},l={},c={loadAll:async function(){const t=await n.A.fetchRemoteFiles(r.sA,r.lC,r.e_,r.Kq),e=t[0],i=t[1],s=t[2],o=t[3];this.loadSprites(e,i),await this.loadSounds(s,o)},loadSprites:async function(t,e){if(!t||!e){const i=await n.A.fetchRemoteFiles(r.sA,r.lC);t=i[0],e=i[1]}for(let i=0;i<t.length;i++){const n=t[i],s=n.name,a=n.type,l=n.offsets.map((t=>new o.J(s,e,{x:t.x*r.hR,y:t.y*r.cl},r.hR,r.cl)));h[s]=new o.k(s,a,l)}},cloneSprite:t=>h[t]?h[t].clone():void 0,getSprite:t=>h[t],loadSounds:async function(t,e){const i=s.A.getContext(),o=s.A.getGainNode();if(!i||!o)throw new Error("Audio context must be initialized before loading sounds");if(!t||!e){const i=await n.A.fetchRemoteFiles(r.e_,r.Kq);t=i[0],e=i[1]}for(let n=0;n<t.length;n++){const s=t[n],r=s.bytes,h=s.offset,c=e.slice(h,h+r),u=await i.decodeAudioData(c),p=s.name,d=s.duration||void 0,g=s.loop||!1,f=s.loop_end||0,m=s.loop_start||0;l[p]=new a.A(p,u,i,o,d,g,m,f)}},cloneSound:t=>l[t]?l[t].clone():void 0,getSound:t=>l[t]}},783:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});var n=i(691);const s=i(820),r={getHitboxFromString:function(t,e,i,n,r){var o=[];return"1"===r.charAt(0)&&o.push([t,e]),"1"===r.charAt(1)&&o.push([t+i/2,e]),"1"===r.charAt(2)&&o.push([t+i,e]),"1"===r.charAt(3)&&o.push([t+i,e+n/2]),"1"===r.charAt(4)&&o.push([t+i,e+n]),"1"===r.charAt(5)&&o.push([t+i/2,e+n]),"1"===r.charAt(6)&&o.push([t,e+n]),"1"===r.charAt(7)&&o.push([t,e+n/2]),o={regions:[o],inverted:!1},s.polygon(s.segments(o))},getPathFromString:function(t,e,i,n,s){const r=[];"1"===s.charAt(0)&&r.push([t,e]),"1"===s.charAt(1)&&r.push([t+i/2,e]),"1"===s.charAt(2)&&r.push([t+i,e]),"1"===s.charAt(3)&&r.push([t+i,e+n/2]),"1"===s.charAt(4)&&r.push([t+i,e+n]),"1"===s.charAt(5)&&r.push([t+i/2,e+n]),"1"===s.charAt(6)&&r.push([t,e+n]),"1"===s.charAt(7)&&r.push([t,e+n/2]);const o=new Path2D;r[0]&&o.moveTo(r[0][0],r[0][1]);for(let t=1;t<r.length;t++)o.lineTo(r[t][0],r[t][1]);return o},compute:function(t){return{regions:[[[t.x,t.y],[t.x+t.width,t.y],[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]]],inverted:!1}},computeMapHitbox:function(t){const e={regions:[],inverted:!1};for(let i=0;i<t.tiles.length;i++)t.tiles[i].hitbox.regions[0]&&e.regions.push(t.tiles[i].hitbox.regions[0]);return s.union(e,{regions:[],inverted:!1})},computeMapHitboxV2:function(t){const e={regions:[],inverted:!1};for(const i of t.tilesIterator())i.block.regions&&i.block.regions[0]&&e.regions.push(i.block.regions[0]);return s.union(e,{regions:[],inverted:!1})},computeHitboxesCollision:function(t,e){const i=s.intersect(t,e);if(i&&i.regions&&i.regions.length>0)return i},getMinX:function(t){if(!t.regions)return;let e;for(let i=0;i<t.regions.length;i++)for(let n=0;n<t.regions[i].length;n++)(void 0===e||e>t.regions[i][n][0])&&(e=t.regions[i][n][0]);return e},getMaxX:function(t){if(!t.regions)return;let e;for(let i=0;i<t.regions.length;i++)for(let n=0;n<t.regions[i].length;n++)(void 0===e||e<t.regions[i][n][0])&&(e=t.regions[i][n][0]);return e},getMinY:function(t){if(!t.regions)return;let e;for(let i=0;i<t.regions.length;i++)for(let n=0;n<t.regions[i].length;n++)(void 0===e||e>t.regions[i][n][1])&&(e=t.regions[i][n][1]);return e},getMaxY:function(t){if(!t.regions)return;let e;for(let i=0;i<t.regions.length;i++)for(let n=0;n<t.regions[i].length;n++)(void 0===e||e<t.regions[i][n][1])&&(e=t.regions[i][n][1]);return e},draw:function(t,e,i,n,s){void 0===i&&(i=0),void 0===n&&(n=0),t.save(),t.globalAlpha=.5,t.fillStyle=s;for(let s=0;s<e.regions.length;s++){t.beginPath();for(let r=0;r<e.regions[s].length;r++)0!==r?t.lineTo(e.regions[s][r][0]+i,e.regions[s][r][1]+n):t.moveTo(e.regions[s][r][0]+i,e.regions[s][r][1]+n);t.closePath(),t.fill()}t.restore()},getCurrentTiles:function(t,e){const i=[];for(const n of t.tilesIterator())(n.x<=e.x&&e.x<=n.x+n.width&&n.y<=e.y&&e.y<=n.y+n.height||n.x<=e.x+e.width&&e.x+e.width<=n.x+n.width&&n.y<=e.y&&e.y<=n.y+n.height||n.x<=e.x+e.width&&e.x+e.width<=n.x+n.width&&n.y<=e.y+e.height&&e.y+e.height<=n.y+n.height||n.x<=e.x&&e.x<=n.x+n.width&&n.y<=e.y+e.height&&e.y+e.height<=n.y+n.height)&&i.push(n);return i},getLinkTile:function(t,e){const i=e.x+e.width/2,n=e.y+e.height/2;for(const e of t.tilesIterator())if(e.x<=i+2&&i<=e.x+e.width-2&&e.y<=n+2&&n<=e.y+e.height-2)return e},getLinkFrontTile:function(t,e){const i=e.tile??this.getLinkTile(t,e);if(i)return e.direction===n.eM&&i.x>=e.x?t.getTile(i.column-1,i.line):e.direction===n.SL&&i.y>=e.y?t.getTile(i.column,i.line-1):e.direction===n.Ao&&i.x+i.width<=e.x+e.width?t.getTile(i.column+1,i.line):e.direction===n.Wi&&i.y+i.height<=e.y+e.height?t.getTile(i.column,i.line+1):i},getReachedMapEdge:function(t,e){return t.x>=e.x?n.eM:t.y>=e.y?n.SL:t.x+t.width<=e.x?n.Ao:t.y+t.height<=e.y?n.Wi:void 0},getHorizontalCenter:function(t){const e=this.getMinX(t);return e+(this.getMaxX(t)-e)/2}}},626:(t,e,i)=>{"use strict";let n,s;i.d(e,{A:()=>r});const r={initContext(){n=new AudioContext,n.suspend(),n.createGain=n.createGain?n.createGain:n.createGainNode,s=n.createGain(),s.connect(n.destination)},initEvents(t,e){const i=this;e.addEventListener("change",(t=>{t.preventDefault(),i.updateVolume(parseInt(t.target.value)/parseInt(t.target.max))})),e.value=50,e.dispatchEvent(new Event("change")),t.addEventListener("change",(t=>{t.target.checked?i.enable():i.disable()})),t.checked=!1,t.dispatchEvent(new Event("change"))},getContext:()=>n,getGainNode:()=>s,updateVolume(t){s.gain.setValueAtTime(t,n.currentTime)},enable(){n.resume()},disable(){n.suspend()},play(t){t.play();const e=t.duration;e&&setTimeout((()=>this.stop(t)),1e3*e)},stop(t){t.stop()}}},66:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});var n=i(987),s=i(691);const r={draw:function(t,e,i,n,r,o,a,h,l){const c=Math.floor(a/s.IL),u=this.splitTextIntoLines(e,o);l=void 0===l?e.length:l,l-=u.length-1;let p=0;for(let e=0;e<u.length;e++){const a=this.alignLine(u[e],o,h),d=a.substring(0,l+this.getSpacesLeft(u[e],o)-p);if(p+=a.length,this.drawLine(t,d,i,n,r),r+=s.IL,e+1>=c)break}},drawLine:function(t,e,i,r,o){for(const a of e){const e=n.A.getSprite(`${s.NB}_${i}_${a.toLowerCase()}`);e&&e.draw(t,r,o,s.tG,s.IL),r+=s.tG}},splitTextIntoLines:function(t,e){const i=[],n=Math.floor(e/s.tG);let r="";const o=t.split(" ");for(const t of o){let e=r.length;e>0&&(e+=1),e+t.length<=n?r+=e>0?` ${t}`:`${t}`:(i.push(r),r=`${t}`)}return r.length>0&&i.push(r),i},getSpacesLeft:function(t,e){return Math.floor(e/s.tG)-t.length},alignLine:function(t,e,i="middle"){const n=this.getSpacesLeft(t,e);let s,r;return"middle"===i&&(s=Math.ceil(n/2),r=Math.floor(n/2)),"right"===i&&(s=n,r=0),"left"===i&&(s=0,r=n),(t=t.padStart(t.length+s," ")).padEnd(t.length+r," ")}}},73:(t,e,i)=>{"use strict";i.d(e,{A:()=>p});var n=i(691),s=i(999),r=i(861),o=i(987),a=i(783),h=i(981),l=i(19),c=i(282),u=i(790);const p={world:[],caverns:[],level1:[],level2:[],level3:[],level4:[],level5:[],level6:[],level7:[],level8:[],level9:[],createMaps(t){this.world=this.createMapsForType("world",t.world),this.caverns=this.createMapsForType("caverns",t.caverns),this.level1=this.createMapsForType("level1",t.level1)},createMapsForType(t,e){const i=[];for(let r=0;r<e.length;r++){const a=e[r],h=a.x,p=a.y,d=n.Zc*n.KP,g=n.N0*n.VM,f=h*d,m=p*g,v=this.createMapTiles(a.tiles,f,m);i[h]||(i[h]=[]);const y=[];for(const t of a.characters){const e=t.x,i=t.y,s=n.KP,r=n.VM,a=f+e*s,h=m+i*r,l=o.A.getSprite(t.sprite),u=t.text;y.push(new c.K(e,i,a,h,s,r,l,u))}const _=[];for(const t of a.items){const e=t.x,i=t.y,s=n.KP,r=n.VM,a=f+e*s,h=m+i*r,l=o.A.getSprite(t.sprite),c=t.price;y.push(new u.q(e,i,a,h,s,r,l,c))}const w=[];for(const t of a.extras){const e=t.x,i=t.y,s=n.KP,r=n.VM,a=f+e*s,h=m+i*r,c=o.A.getSprite(t.sprite);w.push(new l.$(e,i,a,h,s,r,c))}i[h][p]=new s.T(h,p,f,m,d,g,t,v,y,_,w)}return i},createMapTiles(t,e,i){const s=[];for(let l=0;l<t.length;l++){const c=t[l],u=c.x,p=c.y,d=n.KP,g=n.VM,f=u*d+e,m=p*g+i,v=o.A.getSprite(c.sprite),y=a.A.getHitboxFromString(f,m,d,g,c.hitbox),_=new h.A(c.transition?.start,c.transition?.targetMapType,c.transition?.targetMapColumn,c.transition?.targetMapLine,c.transition?.targetTileColumn,c.transition?.targetTileLine,c.transition?.end);s[u]||(s[u]=[]),s[u][p]=new r.F(u,p,f,m,d,g,c.hitbox,v,y,void 0,_,!!c.start)}return s},getMap(t,e,i){return this[t]&&this[t][e]&&this[t][e][i]?this[t][e][i]:void 0},findStartingPosition(){for(const t of this.mapsIterator(n.rH))for(const e of t.tilesIterator())if(e.start)return{map:t,tileColumn:e.column,tileLine:e.line}},*mapsIterator(t){for(let e=0;e<this[t].length;e++)for(let i=0;i<this[t][e].length;i++)yield this[t][e][i]},exportGame(){return{world:this.exportMaps(n.rH),caverns:this.exportMaps(n.vg),level1:this.exportMaps(n.kE)}},exportMaps(t){const e=[];for(const i of this.mapsIterator(t)){const t={x:i.column,y:i.line,tiles:[],characters:[],items:[],extras:[]};for(const e of i.characters)t.characters.push({x:e.column,y:e.line,sprite:e.sprite.name,text:e.text});for(const e of i.items)t.items.push({x:e.column,y:e.line,sprite:e.sprite.name,price:e.price});for(const e of i.extras)t.extras.push({x:e.column,y:e.line,sprite:e.sprite.name});for(const e of i.tilesIterator()){const i={x:e.column,y:e.line,hitbox:e.hitbox,sprite:e.sprite.name};e.tileTransition.isEmpty()||(i.transition={start:e.tileTransition.start,targetMapType:e.tileTransition.targetMapType,targetMapColumn:e.tileTransition.targetMapColumn,targetMapLine:e.tileTransition.targetMapLine,targetTileColumn:e.tileTransition.targetTileColumn,targetTileLine:e.tileTransition.targetTileLine,end:e.tileTransition.end}),e.start&&(i.start=!0),t.tiles.push(i)}e.push(t)}return e}}},151:(t,e,i)=>{"use strict";i.d(e,{A:()=>s});const n="gzip",s={compress:async function(t){const e=new Blob([t]).stream().pipeThrough(new CompressionStream(n)),i=[];for await(const t of e)i.push(t);return await this.concatUint8Arrays(i)},decompress:async function(t){const e=new Blob([t]).stream().pipeThrough(new DecompressionStream(n)),i=[];for await(const t of e)i.push(t);const s=await this.concatUint8Arrays(i);return(new TextDecoder).decode(s)},concatUint8Arrays:async function(t){const e=new Blob(t),i=await e.arrayBuffer();return new Uint8Array(i)}}},113:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});var n=i(151),s=i(691);const r={openFile:async function(t){const e=this;return new Promise(((i,n)=>{const s=document.createElement("input");s.type="file",t&&(s.accept=`.${t}`),s.style.display="none",s.addEventListener("cancel",(()=>{s.remove()})),s.addEventListener("change",(async()=>{const r=s.files;s.remove(),1===r.length?i(await e.readFile(r[0],t)):n()})),document.body.appendChild(s),s.click()}))},readFile:async function(t,e){return e||(e=this.guessTypeFromExtension(t.name)),new Promise(((i,r)=>{const o=new FileReader;switch(o.onload=async t=>{let o=t.target.result;switch(e){case s.sC:o=new Uint8Array(o),o=await n.A.decompress(o);try{o=JSON.parse(o)}catch(t){}i(o);break;case s.tJ:i(JSON.parse(o));break;case s.Sk:const e=await fetch(o),a=await e.blob();i(createImageBitmap(a));break;default:r()}},e){case s.sC:o.readAsArrayBuffer(t);break;case s.Sk:o.readAsDataURL(t);break;case s.tJ:default:o.readAsText(t)}}))},dowloadFile:async function(t,e){const i=prompt("Filename");if(!i)return;switch(e){case s.sC:t=await n.A.compress(t);case s.tJ:}const r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(new Blob([t])),r.download=`${i.toLowerCase()}.${e}`,r.textContent="Download",document.body.appendChild(r),r.click(),document.body.removeChild(r)},fetchRemoteFiles:async function(){let t=Array.prototype.slice.call(arguments);Array.isArray(t)||(t=[t]),1===t.length&&Array.isArray(t[0])&&(t=t[0]);const e=[];for(let i=0;i<t.length;i++)e.push(this.fetchRemoteFile(t[i]));return Promise.all(e)},fetchRemoteFile:async function(t){switch(t.split(".").pop()){case s.tJ:return this.fetchJsonFile(t);case s.sC:return this.fetchLozFile(t);case s.jH:return this.fetchAudioFile(t);case s.Sk:case s.DK:return this.fetchImageFile(t);default:throw new Error(`IO: extension not allowed for file ${t}`)}},fetchLozFile:async t=>{let e=await fetch(t);e=await e.arrayBuffer(),e=new Uint8Array(e),e=await n.A.decompress(e);try{e=JSON.parse(e)}catch(t){}return e},fetchJsonFile:async t=>{let e=await fetch(t);return e=await e.json(),e},fetchImageFile:async t=>{let e=await fetch(t);return e=await e.blob(),e=createImageBitmap(e),e},fetchAudioFile:async t=>{let e=await fetch(t);return e=await e.arrayBuffer(),e},guessTypeFromExtension:t=>t.split(".").at(-1)}},820:(t,e,i)=>{var n,s=i(671),r=i(145),o=i(74),a=i(534),h=i(927),l=i(779),c=!1,u=r();function p(t,e,i){var s=n.segments(t),r=n.segments(e),o=i(n.combine(s,r));return n.polygon(o)}n={buildLog:function(t){return!0===t?c=s():!1===t&&(c=!1),!1!==c&&c.list},epsilon:function(t){return u.epsilon(t)},segments:function(t){var e=o(!0,u,c);return t.regions.forEach(e.addRegion),{segments:e.calculate(t.inverted),inverted:t.inverted}},combine:function(t,e){return{combined:o(!1,u,c).calculate(t.segments,t.inverted,e.segments,e.inverted),inverted1:t.inverted,inverted2:e.inverted}},selectUnion:function(t){return{segments:h.union(t.combined,c),inverted:t.inverted1||t.inverted2}},selectIntersect:function(t){return{segments:h.intersect(t.combined,c),inverted:t.inverted1&&t.inverted2}},selectDifference:function(t){return{segments:h.difference(t.combined,c),inverted:t.inverted1&&!t.inverted2}},selectDifferenceRev:function(t){return{segments:h.differenceRev(t.combined,c),inverted:!t.inverted1&&t.inverted2}},selectXor:function(t){return{segments:h.xor(t.combined,c),inverted:t.inverted1!==t.inverted2}},polygon:function(t){return{regions:a(t.segments,u,c),inverted:t.inverted}},polygonFromGeoJSON:function(t){return l.toPolygon(n,t)},polygonToGeoJSON:function(t){return l.fromPolygon(n,u,t)},union:function(t,e){return p(t,e,n.selectUnion)},intersect:function(t,e){return p(t,e,n.selectIntersect)},difference:function(t,e){return p(t,e,n.selectDifference)},differenceRev:function(t,e){return p(t,e,n.selectDifferenceRev)},xor:function(t,e){return p(t,e,n.selectXor)}},"object"==typeof window&&(window.PolyBool=n),t.exports=n},671:t=>{t.exports=function(){var t,e=0,i=!1;function n(e,i){return t.list.push({type:e,data:i?JSON.parse(JSON.stringify(i)):void 0}),t}return t={list:[],segmentId:function(){return e++},checkIntersection:function(t,e){return n("check",{seg1:t,seg2:e})},segmentChop:function(t,e){return n("div_seg",{seg:t,pt:e}),n("chop",{seg:t,pt:e})},statusRemove:function(t){return n("pop_seg",{seg:t})},segmentUpdate:function(t){return n("seg_update",{seg:t})},segmentNew:function(t,e){return n("new_seg",{seg:t,primary:e})},segmentRemove:function(t){return n("rem_seg",{seg:t})},tempStatus:function(t,e,i){return n("temp_status",{seg:t,above:e,below:i})},rewind:function(t){return n("rewind",{seg:t})},status:function(t,e,i){return n("status",{seg:t,above:e,below:i})},vert:function(e){return e===i?t:(i=e,n("vert",{x:e}))},log:function(t){return"string"!=typeof t&&(t=JSON.stringify(t,!1,"  ")),n("log",{txt:t})},reset:function(){return n("reset")},selected:function(t){return n("selected",{segs:t})},chainStart:function(t){return n("chain_start",{seg:t})},chainRemoveHead:function(t,e){return n("chain_rem_head",{index:t,pt:e})},chainRemoveTail:function(t,e){return n("chain_rem_tail",{index:t,pt:e})},chainNew:function(t,e){return n("chain_new",{pt1:t,pt2:e})},chainMatch:function(t){return n("chain_match",{index:t})},chainClose:function(t){return n("chain_close",{index:t})},chainAddHead:function(t,e){return n("chain_add_head",{index:t,pt:e})},chainAddTail:function(t,e){return n("chain_add_tail",{index:t,pt:e})},chainConnect:function(t,e){return n("chain_con",{index1:t,index2:e})},chainReverse:function(t){return n("chain_rev",{index:t})},chainJoin:function(t,e){return n("chain_join",{index1:t,index2:e})},done:function(){return n("done")}}}},145:t=>{t.exports=function(t){"number"!=typeof t&&(t=1e-10);var e={epsilon:function(e){return"number"==typeof e&&(t=e),t},pointAboveOrOnLine:function(e,i,n){var s=i[0],r=i[1],o=n[0],a=n[1],h=e[0];return(o-s)*(e[1]-r)-(a-r)*(h-s)>=-t},pointBetween:function(e,i,n){var s=e[1]-i[1],r=n[0]-i[0],o=e[0]-i[0],a=n[1]-i[1],h=o*r+s*a;return!(h<t||h-(r*r+a*a)>-t)},pointsSameX:function(e,i){return Math.abs(e[0]-i[0])<t},pointsSameY:function(e,i){return Math.abs(e[1]-i[1])<t},pointsSame:function(t,i){return e.pointsSameX(t,i)&&e.pointsSameY(t,i)},pointsCompare:function(t,i){return e.pointsSameX(t,i)?e.pointsSameY(t,i)?0:t[1]<i[1]?-1:1:t[0]<i[0]?-1:1},pointsCollinear:function(e,i,n){var s=e[0]-i[0],r=e[1]-i[1],o=i[0]-n[0],a=i[1]-n[1];return Math.abs(s*a-o*r)<t},linesIntersect:function(e,i,n,s){var r=i[0]-e[0],o=i[1]-e[1],a=s[0]-n[0],h=s[1]-n[1],l=r*h-o*a;if(Math.abs(l)<t)return!1;var c=e[0]-n[0],u=e[1]-n[1],p=(a*u-h*c)/l,d=(r*u-o*c)/l,g={alongA:0,alongB:0,pt:[e[0]+p*r,e[1]+p*o]};return g.alongA=p<=-t?-2:p<t?-1:p-1<=-t?0:p-1<t?1:2,g.alongB=d<=-t?-2:d<t?-1:d-1<=-t?0:d-1<t?1:2,g},pointInsideRegion:function(e,i){for(var n=e[0],s=e[1],r=i[i.length-1][0],o=i[i.length-1][1],a=!1,h=0;h<i.length;h++){var l=i[h][0],c=i[h][1];c-s>t!=o-s>t&&(r-l)*(s-c)/(o-c)+l-n>t&&(a=!a),r=l,o=c}return a}};return e}},779:t=>{var e={toPolygon:function(t,e){function i(e){if(e.length<=0)return t.segments({inverted:!1,regions:[]});function i(e){var i=e.slice(0,e.length-1);return t.segments({inverted:!1,regions:[i]})}for(var n=i(e[0]),s=1;s<e.length;s++)n=t.selectDifference(t.combine(n,i(e[s])));return n}if("Polygon"===e.type)return t.polygon(i(e.coordinates));if("MultiPolygon"===e.type){for(var n=t.segments({inverted:!1,regions:[]}),s=0;s<e.coordinates.length;s++)n=t.selectUnion(t.combine(n,i(e.coordinates[s])));return t.polygon(n)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(t,e,i){function n(t,i){return e.pointInsideRegion([.5*(t[0][0]+t[1][0]),.5*(t[0][1]+t[1][1])],i)}function s(t){return{region:t,children:[]}}i=t.polygon(t.segments(i));var r=s(null);function o(t,e){for(var i=0;i<t.children.length;i++)if(n(e,(a=t.children[i]).region))return void o(a,e);var r=s(e);for(i=0;i<t.children.length;i++){var a;n((a=t.children[i]).region,e)&&(r.children.push(a),t.children.splice(i,1),i--)}t.children.push(r)}for(var a=0;a<i.regions.length;a++){var h=i.regions[a];h.length<3||o(r,h)}function l(t,e){for(var i=0,n=t[t.length-1][0],s=t[t.length-1][1],r=[],o=0;o<t.length;o++){var a=t[o][0],h=t[o][1];r.push([a,h]),i+=h*n-a*s,n=a,s=h}return i<0!==e&&r.reverse(),r.push([r[0][0],r[0][1]]),r}var c=[];function u(t){var e=[l(t.region,!1)];c.push(e);for(var i=0;i<t.children.length;i++)e.push(p(t.children[i]))}function p(t){for(var e=0;e<t.children.length;e++)u(t.children[e]);return l(t.region,!0)}for(a=0;a<r.children.length;a++)u(r.children[a]);return c.length<=0?{type:"Polygon",coordinates:[]}:1==c.length?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}};t.exports=e},74:(t,e,i)=>{var n=i(92);t.exports=function(t,e,i){function s(t,e,n){return{id:i?i.segmentId():-1,start:t,end:e,myFill:{above:n.myFill.above,below:n.myFill.below},otherFill:null}}var r=n.create();function o(t,i){r.insertBefore(t,(function(n){return s=t.isStart,r=t.pt,o=i,a=n.isStart,h=n.pt,l=n.other.pt,(0!==(c=e.pointsCompare(r,h))?c:e.pointsSame(o,l)?0:s!==a?s?1:-1:e.pointAboveOrOnLine(o,a?h:l,a?l:h)?1:-1)<0;var s,r,o,a,h,l,c}))}function a(t,e){var i=function(t,e){var i=n.node({isStart:!0,pt:t.start,seg:t,primary:e,other:null,status:null});return o(i,t.end),i}(t,e);return function(t,e,i){var s=n.node({isStart:!1,pt:e.end,seg:e,primary:i,other:t,status:null});t.other=s,o(s,t.pt)}(i,t,e),i}function h(t,e){var n=s(e,t.seg.end,t.seg);return function(t,e){i&&i.segmentChop(t.seg,e),t.other.remove(),t.seg.end=e,t.other.pt=e,o(t.other,t.pt)}(t,e),a(n,t.primary)}function l(s,o){var a=n.create();function l(t){return a.findTransition((function(i){var n,s,r,o,a,h;return n=t,s=i.ev,r=n.seg.start,o=n.seg.end,a=s.seg.start,h=s.seg.end,(e.pointsCollinear(r,a,h)?e.pointsCollinear(o,a,h)||e.pointAboveOrOnLine(o,a,h)?1:-1:e.pointAboveOrOnLine(r,a,h)?1:-1)>0}))}function c(t,n){var s=t.seg,r=n.seg,o=s.start,a=s.end,l=r.start,c=r.end;i&&i.checkIntersection(s,r);var u=e.linesIntersect(o,a,l,c);if(!1===u){if(!e.pointsCollinear(o,a,l))return!1;if(e.pointsSame(o,c)||e.pointsSame(a,l))return!1;var p=e.pointsSame(o,l),d=e.pointsSame(a,c);if(p&&d)return n;var g=!p&&e.pointBetween(o,l,c),f=!d&&e.pointBetween(a,l,c);if(p)return f?h(n,a):h(t,c),n;g&&(d||(f?h(n,a):h(t,c)),h(n,o))}else 0===u.alongA&&(-1===u.alongB?h(t,l):0===u.alongB?h(t,u.pt):1===u.alongB&&h(t,c)),0===u.alongB&&(-1===u.alongA?h(n,o):0===u.alongA?h(n,u.pt):1===u.alongA&&h(n,a));return!1}for(var u=[];!r.isEmpty();){var p=r.getHead();if(i&&i.vert(p.pt[0]),p.isStart){i&&i.segmentNew(p.seg,p.primary);var d=l(p),g=d.before?d.before.ev:null,f=d.after?d.after.ev:null;function m(){if(g){var t=c(p,g);if(t)return t}return!!f&&c(p,f)}i&&i.tempStatus(p.seg,!!g&&g.seg,!!f&&f.seg);var v,y,_=m();if(_)t?(y=null===p.seg.myFill.below||p.seg.myFill.above!==p.seg.myFill.below)&&(_.seg.myFill.above=!_.seg.myFill.above):_.seg.otherFill=p.seg.myFill,i&&i.segmentUpdate(_.seg),p.other.remove(),p.remove();if(r.getHead()!==p){i&&i.rewind(p.seg);continue}t?(y=null===p.seg.myFill.below||p.seg.myFill.above!==p.seg.myFill.below,p.seg.myFill.below=f?f.seg.myFill.above:s,p.seg.myFill.above=y?!p.seg.myFill.below:p.seg.myFill.below):null===p.seg.otherFill&&(v=f?p.primary===f.primary?f.seg.otherFill.above:f.seg.myFill.above:p.primary?o:s,p.seg.otherFill={above:v,below:v}),i&&i.status(p.seg,!!g&&g.seg,!!f&&f.seg),p.other.status=d.insert(n.node({ev:p}))}else{var w=p.status;if(null===w)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(a.exists(w.prev)&&a.exists(w.next)&&c(w.prev.ev,w.next.ev),i&&i.statusRemove(w.ev.seg),w.remove(),!p.primary){var x=p.seg.myFill;p.seg.myFill=p.seg.otherFill,p.seg.otherFill=x}u.push(p.seg)}r.getHead().remove()}return i&&i.done(),u}return t?{addRegion:function(t){for(var n,s,r,o=t[t.length-1],h=0;h<t.length;h++){n=o,o=t[h];var l=e.pointsCompare(n,o);0!==l&&a((s=l<0?n:o,r=l<0?o:n,{id:i?i.segmentId():-1,start:s,end:r,myFill:{above:null,below:null},otherFill:null}),!0)}},calculate:function(t){return l(t,!1)}}:{calculate:function(t,e,i,n){return t.forEach((function(t){a(s(t.start,t.end,t),!0)})),i.forEach((function(t){a(s(t.start,t.end,t),!1)})),l(e,n)}}}},92:t=>{t.exports={create:function(){var t={root:{root:!0,next:null},exists:function(e){return null!==e&&e!==t.root},isEmpty:function(){return null===t.root.next},getHead:function(){return t.root.next},insertBefore:function(e,i){for(var n=t.root,s=t.root.next;null!==s;){if(i(s))return e.prev=s.prev,e.next=s,s.prev.next=e,void(s.prev=e);n=s,s=s.next}n.next=e,e.prev=n,e.next=null},findTransition:function(e){for(var i=t.root,n=t.root.next;null!==n&&!e(n);)i=n,n=n.next;return{before:i===t.root?null:i,after:n,insert:function(t){return t.prev=i,t.next=n,i.next=t,null!==n&&(n.prev=t),t}}}};return t},node:function(t){return t.prev=null,t.next=null,t.remove=function(){t.prev.next=t.next,t.next&&(t.next.prev=t.prev),t.prev=null,t.next=null},t}}},534:t=>{t.exports=function(t,e,i){var n=[],s=[];return t.forEach((function(t){var r=t.start,o=t.end;if(e.pointsSame(r,o))console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");else{i&&i.chainStart(t);for(var a={index:0,matches_head:!1,matches_pt1:!1},h={index:0,matches_head:!1,matches_pt1:!1},l=a,c=0;c<n.length;c++){var u=(m=n[c])[0],p=(m[1],m[m.length-1]);if(m[m.length-2],e.pointsSame(u,r)){if(I(c,!0,!0))break}else if(e.pointsSame(u,o)){if(I(c,!0,!1))break}else if(e.pointsSame(p,r)){if(I(c,!1,!0))break}else if(e.pointsSame(p,o)&&I(c,!1,!1))break}if(l===a)return n.push([r,o]),void(i&&i.chainNew(r,o));if(l===h){i&&i.chainMatch(a.index);var d=a.index,g=a.matches_pt1?o:r,f=a.matches_head,m=n[d],v=f?m[0]:m[m.length-1],y=f?m[1]:m[m.length-2],_=f?m[m.length-1]:m[0],w=f?m[m.length-2]:m[1];return e.pointsCollinear(y,v,g)&&(f?(i&&i.chainRemoveHead(a.index,g),m.shift()):(i&&i.chainRemoveTail(a.index,g),m.pop()),v=y),e.pointsSame(_,g)?(n.splice(d,1),e.pointsCollinear(w,_,v)&&(f?(i&&i.chainRemoveTail(a.index,v),m.pop()):(i&&i.chainRemoveHead(a.index,v),m.shift())),i&&i.chainClose(a.index),void s.push(m)):void(f?(i&&i.chainAddHead(a.index,g),m.unshift(g)):(i&&i.chainAddTail(a.index,g),m.push(g)))}var x=a.index,A=h.index;i&&i.chainConnect(x,A);var b=n[x].length<n[A].length;a.matches_head?h.matches_head?b?(T(x),k(x,A)):(T(A),k(A,x)):k(A,x):h.matches_head?k(x,A):b?(T(x),k(A,x)):(T(A),k(x,A))}function I(t,e,i){return l.index=t,l.matches_head=e,l.matches_pt1=i,l===a?(l=h,!1):(l=null,!0)}function T(t){i&&i.chainReverse(t),n[t].reverse()}function k(t,s){var r=n[t],o=n[s],a=r[r.length-1],h=r[r.length-2],l=o[0],c=o[1];e.pointsCollinear(h,a,l)&&(i&&i.chainRemoveTail(t,a),r.pop(),a=h),e.pointsCollinear(a,l,c)&&(i&&i.chainRemoveHead(s,l),o.shift()),i&&i.chainJoin(t,s),n[t]=r.concat(o),n.splice(s,1)}})),s}},927:t=>{function e(t,e,i){var n=[];return t.forEach((function(t){var s=(t.myFill.above?8:0)+(t.myFill.below?4:0)+(t.otherFill&&t.otherFill.above?2:0)+(t.otherFill&&t.otherFill.below?1:0);0!==e[s]&&n.push({id:i?i.segmentId():-1,start:t.start,end:t.end,myFill:{above:1===e[s],below:2===e[s]},otherFill:null})})),i&&i.selected(n),n}var i={union:function(t,i){return e(t,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],i)},intersect:function(t,i){return e(t,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],i)},difference:function(t,i){return e(t,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],i)},differenceRev:function(t,i){return e(t,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],i)},xor:function(t,i){return e(t,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],i)}};t.exports=i}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return s[t](i,i.exports,o),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},o.a=(s,r,o)=>{var a;o&&((a=[]).d=-1);var h,l,c,u=new Set,p=s.exports,d=new Promise(((t,e)=>{c=e,l=t}));d[e]=p,d[t]=t=>(a&&t(a),u.forEach(t),d.catch((t=>{}))),s.exports=d,r((s=>{var r;h=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[t])return s;if(s.then){var r=[];r.d=0,s.then((t=>{o[e]=t,n(r)}),(t=>{o[i]=t,n(r)}));var o={};return o[t]=t=>t(r),o}}var a={};return a[t]=t=>{},a[e]=s,a})))(s);var o=()=>h.map((t=>{if(t[i])throw t[i];return t[e]})),l=new Promise((e=>{(r=()=>e(o)).r=0;var i=t=>t!==a&&!u.has(t)&&(u.add(t),t&&!t.d&&(r.r++,t.push(r)));h.map((e=>e[t](i)))}));return r.r?l:o()}),(t=>(t?c(d[i]=t):l(p),n(a)))),a&&a.d<0&&(a.d=0)},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o(526)})();
//# sourceMappingURL=game.js.map